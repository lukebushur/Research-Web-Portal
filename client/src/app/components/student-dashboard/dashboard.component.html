<cdk-accordion class="example-accordion">
  <cdk-accordion-item #questionAccordionItem="cdkAccordionItem" class="example-accordion-item" role="button"
    tabindex="0" [attr.id]="'question-accordion-header'" [attr.aria-expanded]="questionAccordionItem.expanded"
    [expanded]="true" [attr.aria-controls]="'question-accordion-body'">
    <div class="student-ongoing-applications">
      <h1>Ongoing applications</h1>
      <button mat-raised-button (click)="getStudentApplications()">See all applications</button>
      <button mat-raised-button (click)="searchOpportunities()">Search opportunities</button>
    </div>
    <div class="example-accordion-item-header" (click)="questionAccordionItem.toggle()">
      Previous Stuff in this Page
      <span class="example-accordion-item-description">
        Click to {{ questionAccordionItem.expanded ? 'close' : 'open' }}
      </span>
    </div>
    <div class="example-accordion-item-body" role="region"
      [style.display]="questionAccordionItem.expanded ? '' : 'none'" [attr.id]="'question-accordion-body'"
      [attr.aria-labelledby]="'question-accordion-header'">
      <div class="student-dashboard-page-container">
        <!-- Display opportunities grouped by major -->
        <div *ngFor="let major of majors">
          <h2>{{ major }} Opportunities</h2>

          <div *ngFor="let opportunity of majorOpportunities[major]" class="opportunities-container">
            <mat-card>
              <mat-card-title class="opportunity-card-title">
                {{ opportunity.title }}
              </mat-card-title>
            </mat-card>
            <mat-card-content>
              <p>Professor name: {{ opportunity.professorName }}</p>
              <p>Application email: {{ opportunity.professorEmail }}</p>
              <p> Number of Applicants: {{ opportunity.applications?.length ?? 0 }}</p>
              <p> GPA Requirement: {{ opportunity.GPA ? opportunity.GPA : "No Minimum GPA Requirement" }}</p>
            </mat-card-content>
            <button mat-raised-button color="primary" (click)="applyToOpportunity(opportunity)"
              [disabled]="!meetRequirements(opportunity)">{{ meetRequirements(opportunity) ? 'Apply' : 'Cannot Apply'
              }}</button>
          </div>
        </div>
      </div>
    </div>
  </cdk-accordion-item>
</cdk-accordion>

<cdk-accordion class="example-accordion">
  <cdk-accordion-item #accordionItem="cdkAccordionItem" class="example-accordion-item" role="button" tabindex="1"
    [attr.id]="'accordion-header-'" [attr.aria-expanded]="accordionItem.expanded" [expanded]="true"
    [attr.aria-controls]="'accordion-body-'">
    <div class="example-accordion-item-header" (click)="accordionItem.toggle()">
      Applications Data
      <span class="example-accordion-item-description">
        Click to {{ accordionItem.expanded ? 'close' : 'open' }}
      </span>
    </div>
    <div class="example-accordion-item-body" role="region" [style.display]="accordionItem.expanded ? '' : 'none'"
      [attr.id]="'accordion-body-'" [attr.aria-labelledby]="'accordion-header-'">

      <table mat-table [dataSource]="dataSource" matSort (matSortChange)="sortData($event)" class="mat-elevation-z8">

        <!-- Name Column -->
        <ng-container matColumnDef="project title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by name">
            Project Name
          </th>
          <td mat-cell *matCellDef="let application"><a href="/studentViewApplication/{{application.id}}">{{application.projectName}}</a></td>
        </ng-container>

        <ng-container matColumnDef="project sponsor">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by sponsor name">
            Project Sponsor
          </th>
          <td mat-cell *matCellDef="let application"> {{application.projectSponsor}} </td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="gpa req">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by GPA">
            GPA Req
          </th>
          <td mat-cell *matCellDef="let application"> {{application.GPAREQ}} </td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="applied date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by applied date">
            Applied Date
          </th>
          <td mat-cell *matCellDef="let application"> {{application.appliedDate}} </td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="deadline">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by deadline">
            Deadline
          </th>
          <td mat-cell *matCellDef="let application"> {{application.deadline}} </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
            Status
          </th>
          <td mat-cell *matCellDef="let application"> {{application.status}} </td>
        </ng-container>

        <!-- Symbol Column -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>
  </cdk-accordion-item>
</cdk-accordion>

<app-spinner></app-spinner>